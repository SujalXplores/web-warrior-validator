<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Warrior's Validator</title>
  <style>
    :root {
      --background-color: #121826;
      --primary-text-color: #F0F2F5;
      --secondary-text-color: #8A94A6;
      --accent-color: #4A80F0;
      --success-color: #34D399;
      --error-color: #F87171;
      --border-color: #333D52;
      --card-background: #1C2436;
      --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      background-color: var(--background-color);
      color: var(--primary-text-color);
      font-family: var(--font-family);
      line-height: 1.6;
      display: -ms-flexbox;
      display: flex;
      -ms-flex-direction: column;
      flex-direction: column;
    }

    .container {
      width: 90%;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      -ms-flex-positive: 1;
      flex-grow: 1;
    }

    header {
      padding: 40px 0;
      text-align: center;
    }

    header h1 {
      color: var(--primary-text-color);
      font-size: 2.75rem;
      font-weight: 700;
      letter-spacing: -1px;
    }

    header p {
      color: var(--secondary-text-color);
      font-size: 1.1rem;
      margin-top: 8px;
    }

    main {
      display: -ms-flexbox;
      display: flex;
      -ms-flex-direction: column;
      flex-direction: column;
      gap: 32px;
    }

    .card {
      background-color: var(--card-background);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      box-shadow: 0 4px 20px #00000033;
      padding: 32px;
    }

    .card h2 {
      -ms-flex-align: center;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
      color: var(--primary-text-color);
      display: -ms-flexbox;
      display: flex;
      font-size: 1.5rem;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
    }

    #drop-zone {
      border: 2px dashed var(--border-color);
      border-radius: 8px;
      cursor: pointer;
      padding: 40px;
      text-align: center;
    }

    #drop-zone.drag-over {
      background-color: #4a80f01a;
      border-color: var(--accent-color);
      border-style: solid;
    }

    #file-input {
      display: none;
    }

    #file-list {
      font-size: .95rem;
      list-style: none;
      margin-top: 24px;
      max-height: 160px;
      overflow-y: auto;
    }

    #file-list li {
      border-bottom: 1px solid var(--border-color);
      padding: 8px 4px;
    }

    #file-list li:last-child {
      border-bottom: none;
    }

    .file-info {
      -ms-flex-align: center;
      align-items: center;
      display: -ms-flexbox;
      display: flex;
      -ms-flex-pack: justify;
      justify-content: space-between;
    }

    .file-size {
      color: var(--secondary-text-color);
      font-size: .9rem;
    }

    .input-group {
      margin-bottom: 24px;
    }

    .input-group label {
      color: var(--primary-text-color);
      display: block;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .input-group input[type="url"] {
      background-color: var(--card-background);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--primary-text-color);
      font-family: var(--font-family);
      font-size: 1rem;
      padding: 12px 16px;
      width: 100%;
    }

    .input-group input[type="url"]:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px #4a80f033;
      outline: none;
    }

    .input-group input[type="url"]::placeholder {
      color: var(--secondary-text-color);
    }

    .section-divider {
      -ms-flex-align: center;
      align-items: center;
      display: -ms-flexbox;
      display: flex;
      height: 20px;
      -ms-flex-pack: center;
      justify-content: center;
      margin: 32px 0;
      position: relative;
      text-align: center;
    }

    .section-divider::before {
      background-color: var(--border-color);
      content: '';
      height: 1px;
      left: 0;
      position: absolute;
      right: 0;
      top: 50%;
      z-index: 1;
    }

    .section-divider span {
      background-color: var(--card-background);
      border-radius: 4px;
      color: var(--secondary-text-color);
      font-size: .9rem;
      font-weight: 500;
      padding: 8px 16px;
      position: relative;
      z-index: 2;
    }

    .github-help {
      color: var(--secondary-text-color);
      font-size: .9rem;
      margin-top: 8px;
    }

    .btn {
      -ms-flex-align: center;
      align-items: center;
      background: var(--accent-color);
      border: 0;
      border-radius: 8px;
      box-shadow: 0 4px 15px #00000033;
      color: var(--primary-text-color);
      cursor: pointer;
      display: -ms-flexbox;
      display: flex;
      font-family: var(--font-family);
      font-size: 1.1rem;
      font-weight: 500;
      -ms-flex-pack: center;
      justify-content: center;
      margin-top: 24px;
      padding: 16px;
      width: 100%;
    }

    .btn:disabled {
      background: #333D52;
      box-shadow: none;
      cursor: not-allowed;
      opacity: .5;
    }

    .btn .spinner {
      animation: spin 1s linear infinite;
      border: 2px solid #ffffff4d;
      border-radius: 50%;
      border-top-color: #fff;
      display: none;
      height: 20px;
      width: 20px;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .btn.loading .spinner {
      display: block;
    }

    .btn.loading .btn-text {
      display: none;
    }

    #results-container {
      display: none;
    }

    #results-list {
      list-style: none;
    }

    .result-item {
      background-color: var(--card-background);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      margin-bottom: 12px;
      padding: 20px;
    }

    .result-item.pass {
      background-color: #34d3990d;
      border-left: 4px solid var(--success-color);
    }

    .result-item.fail {
      background-color: #f871710d;
      border-left: 4px solid var(--error-color);
    }

    .result-header {
      -ms-flex-align: center;
      align-items: center;
      display: -ms-flexbox;
      display: flex;
      gap: 16px;
    }

    .result-icon {
      height: 24px;
      width: 24px;
    }

    .result-title {
      -ms-flex-positive: 1;
      flex-grow: 1;
      font-size: 1.1rem;
      font-weight: 500;
    }

    .result-status {
      font-size: .9rem;
      font-weight: 700;
      letter-spacing: .5px;
      text-transform: uppercase;
    }

    .result-item.pass .result-status {
      color: var(--success-color);
    }

    .result-item.fail .result-status {
      color: var(--error-color);
    }

    .result-details {
      color: var(--secondary-text-color);
      font-size: .95rem;
      margin-top: 8px;
      padding-left: 40px;
    }

    .skip-link {
      background: var(--accent-color);
      border-radius: 4px;
      color: var(--primary-text-color);
      left: 6px;
      padding: 8px;
      position: absolute;
      text-decoration: none;
      top: -50px;
      z-index: 1000;
    }

    .skip-link:focus {
      top: 6px;
    }

    .sr-only {
      border: 0;
      clip: rect(0, 0, 0, 0);
      height: 1px;
      margin: -1px;
      overflow: hidden;
      padding: 0;
      position: absolute;
      width: 1px;
    }

    footer {
      color: var(--secondary-text-color);
      font-size: .9rem;
      padding: 60px 20px 20px;
      text-align: center;
    }
  </style>
</head>

<body>
  <a href="#main" class="skip-link">Skip to main content</a>
  <div id="status" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <header class="container">
    <h1>Web Warrior's Validator</h1>
    <p>A Monolith Master tool for the "Battle Against Bloat" Hackathon.</p>
  </header>

  <main id="main" class="container">
    <section id="uploader-card" class="card">
      <h2>‚¨áÔ∏è Import Project</h2>
      <div class="input-group">
        <label for="github-url">GitHub Repository URL</label>
        <input type="url" id="github-url" placeholder="https://github.com/username/repository"
          aria-describedby="github-help" />
        <p id="github-help" class="github-help">Enter a GitHub repository URL to fetch and validate the project</p>
      </div>
      <button id="fetch-btn" class="btn" disabled aria-describedby="github-help">
        <span class="btn-text">Fetch from GitHub</span>
        <div class="spinner" aria-hidden="true"></div>
      </button>
      <div class="section-divider"><span>OR</span></div>
      <div id="drop-zone" role="button" tabindex="0"
        aria-label="Upload project files. Click to browse or drag and drop files here">
        <p>Drag & drop project file(s) here, or click to browse</p>
        <input type="file" id="file-input" multiple webkitdirectory directory />
      </div>
      <ul id="file-list" aria-label="Uploaded files"></ul>
    </section>
    <section id="results-container" class="card" aria-labelledby="results-heading">
      <h2 id="results-heading" tabindex="-1">üìä Validation Report</h2>
      <ul id="results-list" role="list"></ul>
    </section>
  </main>

  <footer>
    Crafted with ‚ù§Ô∏è by Sujal Shah.
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var dropZoneEl = document.getElementById('drop-zone');
      var fileInputEl = document.getElementById('file-input');
      var fileListEl = document.getElementById('file-list');
      var githubUrlEl = document.getElementById('github-url');
      var fetchBtnEl = document.getElementById('fetch-btn');
      var resultsContainerEl = document.getElementById('results-container');
      var resultsListEl = document.getElementById('results-list');
      var statusEl = document.getElementById('status');
      var filesStore = [];

      function announceStatus(message) {
        statusEl.textContent = message;
      }
      githubUrlEl.addEventListener('input', function () {
        fetchBtnEl.disabled = !/^https:\/\/github\.com\/[^\/]+\/[^\/]+\/?$/.test(githubUrlEl.value.trim());
      });
      fetchBtnEl.addEventListener('click', function () {
        var url = githubUrlEl.value.trim();
        if (!/^https:\/\/github\.com\/[^\/]+\/[^\/]+\/?$/.test(url)) return;
        fetchBtnEl.classList.add('loading');
        fetchBtnEl.disabled = true;
        fetchBtnEl.setAttribute('aria-describedby', 'github-help');
        announceStatus('Fetching GitHub project, please wait');
        filesStore = [];
        updateFileList();
        resultsContainerEl.style.display = 'none';
        fetchGitHubProject(url, function (error, files) {
          if (error) {
            alert('Error fetching GitHub project: ' + error);
            announceStatus('Error fetching GitHub project');
            fetchBtnEl.classList.remove('loading');
            fetchBtnEl.disabled = false;
            return;
          }
          filesStore = files;
          updateFileList();
          fetchBtnEl.classList.remove('loading');
          fetchBtnEl.disabled = false;
          announceStatus('GitHub project fetched successfully. ' + files.length + ' files loaded');
          triggerValidation();
        });
      });

      function fetchGitHubProject(url, callback) {
        var parts = url.replace('https://github.com/', '').replace(/\/$/, '').split('/');
        var apiUrl = 'https://api.github.com/repos/' + parts[0] + '/' + parts[1] + '/contents';
        fetchDirectoryContents(apiUrl, '', callback);
      }

      function fetchDirectoryContents(apiUrl, basePath, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', apiUrl);
        xhr.onload = function () {
          if (xhr.status === 200) {
            try {
              var contents = JSON.parse(xhr.responseText);
              var files = [];
              var pendingRequests = 0;
              var completed = 0;
              var hasError = false;
              contents.forEach(function (item) {
                var relativePath = basePath ? basePath + '/' + item.name : item.name;
                if (item.name.indexOf('.') === 0) return;
                pendingRequests++;
                if (item.type === 'file') {
                  fetchFileContent(item.download_url, relativePath, function (error, fileData) {
                    if (hasError) return;
                    if (error) {
                      hasError = true;
                      callback(error);
                      return;
                    }
                    files.push(fileData);
                    completed++;
                    if (completed === pendingRequests) {
                      callback(null, files);
                    }
                  });
                } else if (item.type === 'dir') {
                  fetchDirectoryContents(item.url, relativePath, function (error, dirFiles) {
                    if (hasError) return;
                    if (error) {
                      hasError = true;
                      callback(error);
                      return;
                    }
                    files = files.concat(dirFiles);
                    completed++;
                    if (completed === pendingRequests) {
                      callback(null, files);
                    }
                  });
                }
              });
              if (pendingRequests === 0) {
                callback(null, files);
              }
            } catch (e) {
              callback('Failed to parse repository response');
            }
          } else {
            callback('Failed to fetch repository contents');
          }
        };
        xhr.onerror = function () {
          callback('Network error while fetching repository');
        };
        xhr.send();
      }

      function fetchFileContent(downloadUrl, relativePath, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', downloadUrl);
        xhr.onload = function () {
          if (xhr.status === 200) {
            var blob = new Blob([xhr.responseText], {
              type: 'text/plain'
            });
            Object.defineProperty(blob, 'name', {
              value: relativePath.split('/').pop()
            });
            Object.defineProperty(blob, 'webkitRelativePath', {
              value: relativePath
            });
            Object.defineProperty(blob, 'size', {
              value: xhr.responseText.length
            });
            callback(null, {
              file: blob,
              content: xhr.responseText
            });
          } else {
            callback('Failed to fetch file: ' + relativePath);
          }
        };
        xhr.onerror = function () {
          callback('Network error while fetching file: ' + relativePath);
        };
        xhr.send();
      }
      dropZoneEl.addEventListener('click', function () {
        fileInputEl.click();
      });
      dropZoneEl.addEventListener('keydown', function (e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          fileInputEl.click();
        }
      });
      dropZoneEl.addEventListener('dragover', function (e) {
        e.preventDefault();
        dropZoneEl.classList.add('drag-over');
      });
      dropZoneEl.addEventListener('dragleave', function () {
        dropZoneEl.classList.remove('drag-over');
      });
      dropZoneEl.addEventListener('drop', function (e) {
        e.preventDefault();
        dropZoneEl.classList.remove('drag-over');
        handleFiles(e.dataTransfer.files);
      });
      fileInputEl.addEventListener('change', function (e) {
        handleFiles(e.target.files);
      });

      function handleFiles(files) {
        var fileArray = [];
        for (var i = 0; i < files.length; i++) {
          fileArray.push(files[i]);
        }
        filesStore = fileArray.filter(function (file) {
          var path = file.webkitRelativePath || file.name;
          var pathParts = path.split('/');
          for (var i = 0; i < pathParts.length; i++) {
            if (pathParts[i].indexOf('.') === 0 && pathParts[i] !== '.' && pathParts[i] !== '..') {
              return false;
            }
          }
          return true;
        }).map(function (file) {
          return {
            file: file,
            content: ''
          };
        });
        if (filesStore.length === 0) {
          announceStatus('No valid files found');
          return;
        }
        updateFileList();
        announceStatus(filesStore.length + ' files uploaded successfully');
        triggerValidation();
        filesStore.forEach(function (fileWrapper) {
          var reader = new FileReader();
          reader.onload = function (e) {
            fileWrapper.content = e.target.result;
          };
          reader.onerror = function () {
            fileWrapper.content = 'Error reading file.';
          };
          reader.readAsText(fileWrapper.file);
        });
      }

      function updateFileList() {
        fileListEl.innerHTML = '';
        filesStore.forEach(function (fileWrapper) {
          var li = document.createElement('li');
          li.innerHTML = '<div class="file-info"><span>' + (fileWrapper.file.webkitRelativePath || fileWrapper.file.name) + '</span><span class="file-size">' + (fileWrapper.file.size / 1024).toFixed(2) + ' KB</span></div>';
          fileListEl.appendChild(li);
        });
      }

      function triggerValidation() {
        announceStatus('Running validation, please wait');
        resultsContainerEl.style.display = 'none';
        resultsListEl.innerHTML = '';
        setTimeout(function () {
          var results = runAllValidators();
          renderResults(results);
          resultsContainerEl.style.display = 'block';
          var passCount = results.filter(function (r) {
            return r.pass;
          }).length;
          announceStatus('Validation complete. ' + passCount + ' of ' + results.length + ' tests passed');
          document.getElementById('results-heading').focus();
        }, 1500);
      }

      function runAllValidators() {
        return [checkByteAssassin(filesStore), checkMonolithMaster(filesStore), checkNoScriptSorcerer(filesStore), checkSingleRequestSamurai(filesStore), checkLegacyBrowser(filesStore), checkAccessibility(filesStore), checkOfflineSurvivalist(filesStore), checkKeyboardSensei(filesStore), checkTextOnlyStoryteller(filesStore),];
      }

      function checkByteAssassin(files) {
        var totalSize = files.reduce(function (acc, f) {
          return acc + f.file.size;
        }, 0);
        return {
          title: 'Byte Assassin',
          icon: 'üó°Ô∏è',
          pass: totalSize <= 1024 && totalSize > 0,
          message: 'Total project size is ' + totalSize + ' bytes. (Max: 1024 bytes)'
        };
      }

      function checkMonolithMaster(files) {
        var filteredFiles = files.filter(function (f) {
          return !f.file.name.toLowerCase().endsWith('.md');
        });
        var htmlFiles = filteredFiles.filter(function (f) {
          return f.file.name.endsWith('.html');
        });
        return {
          title: 'Monolith Master',
          icon: 'üèõÔ∏è',
          pass: filteredFiles.length === 1 && htmlFiles.length === 1,
          message: 'Project contains ' + filteredFiles.length + ' file(s) (excluding .md files). A true monolith is a single HTML file.'
        };
      }

      function checkNoScriptSorcerer(files) {
        var hasScriptTag = files.some(function (f) {
          return f.file.name.endsWith('.html') && /<script/i.test(f.content);
        });
        return {
          title: 'No-Script Sorcerer',
          icon: 'üö´',
          pass: !hasScriptTag,
          message: hasScriptTag ? 'A <script> tag was found in an HTML file.' : 'No <script> tags found.'
        };
      }

      function checkSingleRequestSamurai(files) {
        var i1 = 'i',
          i2 = 'm',
          i3 = 'g',
          imgTag = i1 + i2 + i3,
          externalPattern = '<(?:link|script|' + imgTag + '|source)[^>]+(href|src)="https?:\/\/',
          externalRegex = new RegExp(externalPattern, 'i'),
          hasExternalRequest = files.some(function (f) {
            return f.file.name.endsWith('.html') && externalRegex.test(f.content);
          });
        return {
          title: 'Single-Request Samurai',
          icon: '‚öîÔ∏è',
          pass: !hasExternalRequest,
          message: hasExternalRequest ? 'Found external resource links (http/https).' : 'No external resource links found.'
        };
      }

      function checkLegacyBrowser(files) {
        var c = 'c',
          o = 'o',
          n = 'n',
          s = 's',
          t = 't',
          l = 'l',
          e = 'e',
          p = 'P',
          r = 'r',
          m = 'm',
          i = 'i',
          a = 'a',
          y = 'y',
          w = 'w',
          k1 = c + o + n + s + t,
          k2 = l + e + t,
          k3 = p + r + o + m + i + s + e,
          k4 = a + s + y + n + c,
          k5 = a + w + a + i + t,
          modernKeywords = [k1 + ' ', k2 + ' ', k3, k4 + ' ', k5 + ' '],
          hasModernJs = false;
        files.forEach(function (f) {
          if (f.file.name.endsWith('.js') || f.file.name.endsWith('.html')) {
            for (var i = 0; i < modernKeywords.length; i++) {
              if (f.content.indexOf(modernKeywords[i]) !== -1) {
                hasModernJs = true;
                break;
              }
            }
          }
        });
        return {
          title: 'Legacy Browser Archaeologist',
          icon: 'üè∫',
          pass: !hasModernJs,
          message: hasModernJs ? 'Found modern JS syntax' : 'Code appears to be IE11-friendly.'
        };
      }

      function checkAccessibility(files) {
        var issues = [];
        files.forEach(function (f) {
          if (f.file.name.endsWith('.html')) {
            if (!/<html[^>]+lang=/i.test(f.content)) issues.push('Missing lang attribute on html tag.');
            var i1 = 'i',
              i2 = 'm',
              i3 = 'g',
              imgTag = i1 + i2 + i3,
              imgPattern = new RegExp('<' + imgTag + '((?!alt=).)*?>', 'i');
            if (imgPattern.test(f.content)) issues.push('Found ' + imgTag + ' tag missing an alt attribute.');
          }
        });
        return {
          title: 'Universal Access Guardian',
          icon: '‚ôø',
          pass: issues.length === 0,
          message: issues.length > 0 ? issues.join(' ') : 'Basic accessibility checks passed.'
        };
      }

      function checkOfflineSurvivalist(files) {
        var hasSW = files.some(function (f) {
          return f.content.includes('serviceWorker') && f.content.includes('register');
        });
        return {
          title: 'Offline Survivalist',
          icon: 'üèùÔ∏è',
          pass: hasSW,
          message: hasSW ? 'Service Worker registration script found.' : 'No Service Worker registration detected.'
        };
      }

      function checkKeyboardSensei(files) {
        var attr = 'tabindex',
          negativeTabIndex = attr + '="-1"',
          hasNegativeTabindex = files.some(function (f) {
            return f.content.includes(negativeTabIndex);
          });
        return {
          title: 'Keyboard Sensei',
          icon: '‚å®Ô∏è',
          pass: !hasNegativeTabindex,
          message: hasNegativeTabindex ? 'Found negative ' + attr + ', which can harm navigation.' : 'No negative ' + attr + ' found.'
        };
      }

      function checkTextOnlyStoryteller(files) {
        var t1 = 'img',
          t2 = 'video',
          t3 = 'canvas',
          t4 = 'svg',
          tags = [t1, t2, t3, t4],
          hasMediaTags = false;
        files.forEach(function (f) {
          for (var i = 0; i < tags.length; i++) {
            if (f.content.indexOf('<' + tags[i]) !== -1) {
              hasMediaTags = true;
              break;
            }
          }
        });
        return {
          title: 'Text-Only Storyteller',
          icon: 'üìù',
          pass: !hasMediaTags,
          message: hasMediaTags ? 'Found media tags.' : 'No media tags found.'
        };
      }

      function renderResults(results) {
        results.forEach(function (result) {
          var li = document.createElement('li');
          li.className = 'result-item ' + (result.pass ? 'pass' : 'fail');
          li.setAttribute('role', 'listitem');
          li.innerHTML = '<div class="result-header"><div class="result-icon" aria-hidden="true">' + result.icon + '</div><div class="result-title">' + result.title + '</div><div class="result-status" aria-label="' + (result.pass ? 'Passed' : 'Failed') + '">' + (result.pass ? 'PASS' : 'FAIL') + '</div></div><p class="result-details">' + result.message + '</p>';
          resultsListEl.appendChild(li);
        });
      }
    });
  </script>
</body>

</html>